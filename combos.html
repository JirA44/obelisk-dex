<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBELISK - Combo Investment Products</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(100, 200, 255, 0.2);
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(90deg, #00d4ff, #7b2fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #00d4ff;
        }

        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(180deg, transparent, rgba(0, 212, 255, 0.05));
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #fff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 20px;
            color: #888;
            max-width: 800px;
            margin: 0 auto;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 60px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.3);
            margin: 20px 40px;
            border-radius: 15px;
            border: 1px solid rgba(100, 200, 255, 0.1);
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .section-title {
            text-align: center;
            padding: 40px 20px 20px;
        }

        .section-title h2 {
            font-size: 32px;
            color: #fff;
            margin-bottom: 10px;
        }

        .section-title p {
            color: #666;
        }

        .risk-filter {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .risk-btn {
            padding: 10px 25px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            background: rgba(0, 0, 0, 0.3);
            color: #aaa;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .risk-btn:hover, .risk-btn.active {
            background: linear-gradient(90deg, #00d4ff, #7b2fff);
            color: #fff;
            border-color: transparent;
        }

        .combos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
            padding: 20px 40px 60px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .combo-card {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 20px;
            border: 1px solid rgba(100, 200, 255, 0.15);
            overflow: hidden;
            transition: all 0.3s;
        }

        .combo-card:hover {
            transform: translateY(-5px);
            border-color: rgba(100, 200, 255, 0.4);
            box-shadow: 0 20px 40px rgba(0, 212, 255, 0.1);
        }

        .combo-header {
            padding: 25px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(123, 47, 255, 0.1));
            border-bottom: 1px solid rgba(100, 200, 255, 0.1);
        }

        .combo-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .combo-icon {
            font-size: 40px;
        }

        .combo-name {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }

        .combo-desc {
            color: #888;
            font-size: 14px;
            line-height: 1.5;
        }

        .combo-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px 25px;
            background: rgba(0, 0, 0, 0.2);
        }

        .combo-stat {
            text-align: center;
        }

        .combo-stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00d4ff;
        }

        .combo-stat-value.green { color: #00ff88; }
        .combo-stat-value.orange { color: #ffaa00; }
        .combo-stat-value.red { color: #ff6666; }

        .combo-stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 3px;
        }

        .combo-allocation {
            padding: 20px 25px;
        }

        .allocation-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .allocation-bar {
            display: flex;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .allocation-segment {
            transition: all 0.3s;
        }

        .allocation-segment:hover {
            filter: brightness(1.3);
        }

        .allocation-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: #888;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .combo-explanation {
            padding: 20px 25px;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .explanation-title {
            font-size: 14px;
            color: #00d4ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explanation-text {
            font-size: 13px;
            color: #999;
            line-height: 1.6;
        }

        .combo-howto {
            padding: 20px 25px;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
        }

        .howto-title {
            font-size: 14px;
            color: #7b2fff;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .howto-steps {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .howto-step {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 12px;
            color: #888;
        }

        .step-number {
            background: linear-gradient(135deg, #00d4ff, #7b2fff);
            color: #fff;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .combo-actions {
            padding: 20px 25px;
            display: flex;
            gap: 10px;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
        }

        .btn-invest {
            flex: 1;
            padding: 12px;
            background: linear-gradient(90deg, #00d4ff, #7b2fff);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-invest:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3);
        }

        .btn-details {
            padding: 12px 20px;
            background: transparent;
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 10px;
            color: #aaa;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-details:hover {
            border-color: #00d4ff;
            color: #00d4ff;
        }

        .risk-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 10px;
        }

        .risk-minimal { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .risk-low { background: rgba(0, 200, 255, 0.2); color: #00d4ff; }
        .risk-low-medium { background: rgba(255, 200, 0, 0.2); color: #ffc800; }
        .risk-medium { background: rgba(255, 150, 0, 0.2); color: #ff9600; }
        .risk-medium-high { background: rgba(255, 100, 100, 0.2); color: #ff6464; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a3a, #0a0a2a);
            border-radius: 20px;
            border: 1px solid rgba(100, 200, 255, 0.2);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(100, 200, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: #666;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 25px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #888;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 200, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 18px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .investment-preview {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .preview-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .preview-row:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #00d4ff;
        }

        .footer {
            text-align: center;
            padding: 40px;
            color: #444;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
        }

        @media (max-width: 768px) {
            .combos-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .hero h1 {
                font-size: 32px;
            }

            .stats-bar {
                flex-direction: column;
                gap: 20px;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">OBELISK</div>
        <nav class="nav-links">
            <a href="index.html">Trading</a>
            <a href="app.html">App</a>
            <a href="tools.html">Tools</a>
            <a href="combos.html" class="active">Combos</a>
            <a href="docs.html">Docs</a>
        </nav>
    </header>

    <section class="hero">
        <h1>Combo Investment Products</h1>
        <p>Stratégies d'investissement combinées - Diversification automatique multi-produits avec protection du capital. Investissez en un clic dans des portefeuilles optimisés par des experts.</p>
    </section>

    <div class="stats-bar">
        <div class="stat">
            <div class="stat-value">14</div>
            <div class="stat-label">Stratégies Disponibles</div>
        </div>
        <div class="stat">
            <div class="stat-value">4-20%</div>
            <div class="stat-label">APY Range</div>
        </div>
        <div class="stat">
            <div class="stat-value">60-100%</div>
            <div class="stat-label">Protection Capital</div>
        </div>
        <div class="stat">
            <div class="stat-value">$50</div>
            <div class="stat-label">Investissement Min</div>
        </div>
    </div>

    <div class="section-title">
        <h2>Choisissez Votre Stratégie</h2>
        <p>Filtrez par niveau de risque</p>
    </div>

    <div class="risk-filter">
        <button class="risk-btn active" onclick="filterByRisk('all')">Tous</button>
        <button class="risk-btn" onclick="filterByRisk('Minimal')">Minimal</button>
        <button class="risk-btn" onclick="filterByRisk('Low')">Low</button>
        <button class="risk-btn" onclick="filterByRisk('Low-Medium')">Low-Medium</button>
        <button class="risk-btn" onclick="filterByRisk('Medium')">Medium</button>
        <button class="risk-btn" onclick="filterByRisk('Medium-High')">Medium-High</button>
    </div>

    <div class="combos-grid" id="combosGrid">
        <!-- Combos will be loaded here -->
    </div>

    <!-- Investment Modal -->
    <div class="modal" id="investModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Investir</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Montant (USDC)</label>
                    <input type="number" id="investAmount" placeholder="1000" oninput="updatePreview()">
                </div>
                <div class="investment-preview" id="investmentPreview">
                    <!-- Preview will be shown here -->
                </div>
                <button class="btn-invest" style="width: 100%; margin-top: 20px;" onclick="confirmInvest()">
                    Confirmer l'investissement
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>OBELISK DEX - Non-Custodial Trading Platform</p>
        <p style="margin-top: 10px; font-size: 12px;">Les rendements passés ne garantissent pas les rendements futurs. Investissez de manière responsable.</p>
    </footer>

    <script src="js/config.js"></script>
    <script>
        const API_BASE = ObeliskConfig.getApiUrl();
        let combosData = [];
        let selectedCombo = null;

        const allocationColors = {
            vault: '#00d4ff',
            bond: '#7b2fff',
            staking: '#00ff88',
            yield: '#ffc800',
            index: '#ff6464',
            dca: '#ff00ff',
            insurance: '#888888'
        };

        const productNames = {
            vault: 'Vault',
            bond: 'Obligation',
            staking: 'Staking',
            yield: 'Yield Opt.',
            index: 'Index',
            dca: 'DCA',
            insurance: 'Assurance'
        };

        const explanations = {
            'SAFE_HAVEN': {
                what: "Safe Haven combine 3 produits ultra-sécurisés: un vault de stablecoins (60%), des obligations Treasury (30%), et une assurance DeFi (10%). Votre capital est 100% protégé - vous ne pouvez pas perdre d'argent.",
                howto: [
                    "Connectez votre wallet et déposez des USDC",
                    "Choisissez le montant (min $100)",
                    "Vos fonds sont automatiquement répartis dans les 3 produits",
                    "Les intérêts s'accumulent quotidiennement",
                    "Retirez à tout moment sans pénalité"
                ]
            },
            'STABLE_MAXIMIZER': {
                what: "Stable Maximizer optimise le rendement sur stablecoins en combinant le Yield Optimizer (50%), des Corporate Bonds (30%), et un Vault stable (20%). Zéro exposition crypto, rendement maximisé.",
                howto: [
                    "Déposez minimum $500 en USDC",
                    "Le Yield Optimizer cherche les meilleurs taux automatiquement",
                    "Les bonds ajoutent un revenu fixe garanti",
                    "Rééquilibrage hebdomadaire automatique",
                    "Retrait possible à tout moment"
                ]
            },
            'BALANCED_GROWTH': {
                what: "Balanced Growth offre une croissance équilibrée: 40% en vault stable, 20% staking ETH, 25% index conservateur, 15% bonds. Exposition crypto limitée (30%) avec 85% de protection.",
                howto: [
                    "Investissez minimum $250",
                    "Votre capital est diversifié sur 4 produits",
                    "L'ETH staké génère des récompenses continues",
                    "L'index suit les meilleures cryptos prudemment",
                    "Rééquilibrage hebdomadaire pour maintenir les ratios"
                ]
            },
            'SMART_SAVER': {
                what: "Smart Saver est conçu pour les épargnants intelligents: 45% yield optimizer, 25% vault Blue Chip (ETH/BTC), 20% DCA Bitcoin hebdomadaire, 10% assurance. 90% de protection du capital.",
                howto: [
                    "Déposez minimum $200",
                    "Le DCA achète automatiquement du BTC chaque semaine",
                    "Le vault Blue Chip expose aux majors avec protection",
                    "L'assurance protège contre les risques smart contract",
                    "Surveillez la croissance de votre portefeuille BTC"
                ]
            },
            'BLUE_CHIP_COMBO': {
                what: "Blue Chip Combo maximise l'exposition aux cryptos majeures: 35% staking ETH, 30% vault BTC/ETH, 25% DCA mix, 10% bonds. Idéal pour accumuler BTC et ETH avec rendement.",
                howto: [
                    "Investissez minimum $500",
                    "35% de vos fonds stakent de l'ETH (4.2% APY)",
                    "Le DCA achète 50% BTC / 50% ETH chaque semaine",
                    "Le vault protège vos positions Blue Chip",
                    "Parfait pour une stratégie d'accumulation long terme"
                ]
            },
            'YIELD_HUNTER': {
                what: "Yield Hunter chasse les meilleurs rendements: 35% Multi-Chain Optimizer, 25% High Yield Bonds (12% APY), 20% staking SOL, 20% staking ATOM. Rendements 8-15% avec 75% protection.",
                howto: [
                    "Minimum $1000 requis",
                    "Le Multi-Chain cherche les meilleurs yields cross-chain",
                    "Les High Yield Bonds offrent 12% garanti sur 60 jours",
                    "SOL et ATOM sont stakés pour maximiser les récompenses",
                    "Rééquilibrage quotidien pour optimiser les rendements"
                ]
            },
            'TOTAL_DIVERSIFIED': {
                what: "Total Diversified utilise TOUS les 7 produits: vault, staking, bonds, index, yield optimizer, DCA, et assurance. Diversification maximale avec 82% de protection du capital.",
                howto: [
                    "Investissez minimum $1000",
                    "Vos fonds sont répartis sur 7 produits différents",
                    "L'index Top 10 suit les meilleures cryptos",
                    "Le DCA diversifié accumule BTC, ETH, SOL, LINK",
                    "L'assurance protège l'ensemble du portefeuille"
                ]
            },
            'DEFI_EXPLORER': {
                what: "DeFi Explorer vous expose au monde DeFi: 30% index DeFi (UNI, AAVE, etc.), 25% vault DeFi Safe, 25% Multi-Chain yield, 20% Corporate Bonds. Pour les enthousiastes DeFi avec filet de sécurité.",
                howto: [
                    "Déposez minimum $500",
                    "L'index DeFi vous expose aux leaders du secteur",
                    "Le vault DeFi Safe protège vos positions",
                    "Le yield farming cross-chain optimise les rendements",
                    "Rééquilibrage quotidien selon les conditions du marché"
                ]
            },
            'PASSIVE_INCOME': {
                what: "Passive Income génère un revenu mensuel stable: 35% Treasury Bonds, 25% Corporate Bonds, 25% Stable Vault, 15% Yield Optimizer. 95% protection pour un revenu régulier.",
                howto: [
                    "Investissez minimum $1000",
                    "60% en obligations garantissent un revenu fixe",
                    "Les intérêts sont distribués mensuellement",
                    "Parfait pour compléter vos revenus",
                    "Retirez les intérêts ou réinvestissez automatiquement"
                ]
            },
            'RETIREMENT_BUILDER': {
                what: "Retirement Builder est conçu pour le long terme: 40% Treasury 90 jours, 30% Stable Vault, 20% Stable Income Index, 10% Full Insurance. 98% protection ultra-conservatrice.",
                howto: [
                    "Investissez minimum $5000",
                    "Stratégie optimisée pour 5+ ans d'investissement",
                    "Les Treasury 90j offrent les meilleurs taux garantis",
                    "L'assurance complète protège tout votre portefeuille",
                    "Laissez les intérêts composés travailler pour vous"
                ]
            },
            'L2_OPPORTUNITY': {
                what: "L2 Opportunity se concentre sur Layer 2: 35% index L2 (ARB, OP, MATIC), 30% Emerging Vault, 20% staking MATIC, 15% bonds. Pour parier sur l'adoption des L2.",
                howto: [
                    "Déposez minimum $300",
                    "L'index L2 suit les performances de ARB, OP, MATIC, IMX, LRC",
                    "Le staking MATIC génère 5.5% de récompenses",
                    "Le vault Emerging protège avec 90% de garantie",
                    "Rééquilibrage quotidien pour capturer les opportunités"
                ]
            },
            'STAKING_MASTER': {
                what: "Staking Master optimise le staking multi-chain: 30% ETH, 25% SOL, 20% ATOM, 15% AVAX, 10% vault stable. Recevez des tokens liquides (stETH, stSOL, etc.) tradables.",
                howto: [
                    "Investissez minimum $500",
                    "Recevez stETH, stSOL, stATOM, stAVAX en échange",
                    "Ces tokens sont liquides - vous pouvez les trader",
                    "Les récompenses de staking s'accumulent automatiquement",
                    "Le vault stable sert de réserve de sécurité"
                ]
            },
            'ULTRA_CONSERVATIVE': {
                what: "Ultra Conservative est le plus sûr: 50% Treasury 7j, 40% Stable Vault, 10% assurance depeg. 100% protection garantie, idéal pour les investisseurs très prudents ou les débutants.",
                howto: [
                    "Investissez dès $50 seulement",
                    "Les Treasury 7j sont les plus sûrs du marché",
                    "L'assurance depeg protège si un stablecoin dévie",
                    "Rééquilibrage quotidien automatique",
                    "Parfait pour découvrir l'investissement crypto sans risque"
                ]
            },
            'AGGRESSIVE_YIELD': {
                what: "Aggressive Yield maximise les rendements: 30% High Yield Bonds (12%), 30% Multi-Chain (10%), 20% staking ATOM (8.2%), 20% DeFi Index. Pour les investisseurs expérimentés cherchant 12-20% APY.",
                howto: [
                    "Minimum $2000 requis - stratégie avancée",
                    "60% de protection signifie plus de risque",
                    "Les rendements élevés compensent la volatilité",
                    "Rééquilibrage quotidien pour maximiser les gains",
                    "Recommandé pour les investisseurs expérimentés uniquement"
                ]
            }
        };

        async function loadCombos() {
            try {
                const response = await fetch(`${API_BASE}/api/passive/combos`);
                const data = await response.json();
                combosData = data.combos;
                renderCombos(combosData);
            } catch (error) {
                console.error('Error loading combos:', error);
                document.getElementById('combosGrid').innerHTML = '<p style="text-align:center;color:#ff6464;">Erreur de chargement. Vérifiez que le serveur est lancé.</p>';
            }
        }

        function renderCombos(combos) {
            const grid = document.getElementById('combosGrid');
            grid.innerHTML = combos.map(combo => {
                const explanation = explanations[combo.id] || { what: combo.description, howto: ['Investissez et laissez faire'] };
                const riskClass = combo.riskLevel.toLowerCase().replace(' ', '-').replace('/', '-');

                return `
                    <div class="combo-card" data-risk="${combo.riskLevel}">
                        <div class="combo-header">
                            <div class="combo-title">
                                <span class="combo-icon">${combo.icon}</span>
                                <span class="combo-name">${combo.name}</span>
                            </div>
                            <div class="combo-desc">${combo.description}</div>
                            <span class="risk-badge risk-${riskClass}">${combo.riskLevel}</span>
                        </div>

                        <div class="combo-stats">
                            <div class="combo-stat">
                                <div class="combo-stat-value green">${combo.expectedApy}</div>
                                <div class="combo-stat-label">APY Attendu</div>
                            </div>
                            <div class="combo-stat">
                                <div class="combo-stat-value">${combo.capitalProtection}</div>
                                <div class="combo-stat-label">Protection</div>
                            </div>
                            <div class="combo-stat">
                                <div class="combo-stat-value">$${combo.minInvestment}</div>
                                <div class="combo-stat-label">Minimum</div>
                            </div>
                        </div>

                        <div class="combo-allocation">
                            <div class="allocation-title">Répartition du portefeuille</div>
                            <div class="allocation-bar">
                                ${combo.allocation.map(a => `
                                    <div class="allocation-segment"
                                         style="width: ${a.weight}; background: ${allocationColors[a.product]}"
                                         title="${productNames[a.product]}: ${a.weight}">
                                    </div>
                                `).join('')}
                            </div>
                            <div class="allocation-legend">
                                ${combo.allocation.map(a => `
                                    <div class="legend-item">
                                        <div class="legend-dot" style="background: ${allocationColors[a.product]}"></div>
                                        ${productNames[a.product]} ${a.weight}
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="combo-explanation">
                            <div class="explanation-title">
                                <span>&#128161;</span> Qu'est-ce que c'est ?
                            </div>
                            <div class="explanation-text">${explanation.what}</div>
                        </div>

                        <div class="combo-howto">
                            <div class="howto-title">
                                <span>&#128736;</span> Comment ça marche ?
                            </div>
                            <div class="howto-steps">
                                ${explanation.howto.map((step, i) => `
                                    <div class="howto-step">
                                        <span class="step-number">${i + 1}</span>
                                        <span>${step}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="combo-actions">
                            <button class="btn-invest" onclick="openInvestModal('${combo.id}')">
                                Investir Maintenant
                            </button>
                            <button class="btn-details" onclick="showDetails('${combo.id}')">
                                Détails
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterByRisk(risk) {
            document.querySelectorAll('.risk-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (risk === 'all') {
                renderCombos(combosData);
            } else {
                const filtered = combosData.filter(c => c.riskLevel === risk);
                renderCombos(filtered);
            }
        }

        function openInvestModal(comboId) {
            selectedCombo = combosData.find(c => c.id === comboId);
            if (!selectedCombo) return;

            document.getElementById('modalTitle').textContent = `Investir dans ${selectedCombo.name}`;
            document.getElementById('investAmount').value = selectedCombo.minInvestment;
            updatePreview();
            document.getElementById('investModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('investModal').classList.remove('active');
        }

        function updatePreview() {
            if (!selectedCombo) return;

            const amount = parseFloat(document.getElementById('investAmount').value) || 0;
            const preview = document.getElementById('investmentPreview');

            if (amount < selectedCombo.minInvestment) {
                preview.innerHTML = `<p style="color: #ff6464;">Minimum requis: $${selectedCombo.minInvestment}</p>`;
                return;
            }

            const apyMin = parseFloat(selectedCombo.expectedApy.split('-')[0]);
            const apyMax = parseFloat(selectedCombo.expectedApy.split('-')[1]);
            const yearlyMin = amount * apyMin / 100;
            const yearlyMax = amount * apyMax / 100;

            preview.innerHTML = `
                <div class="preview-row">
                    <span>Montant investi</span>
                    <span>$${amount.toFixed(2)}</span>
                </div>
                <div class="preview-row">
                    <span>Protection capital</span>
                    <span>${selectedCombo.capitalProtection}</span>
                </div>
                <div class="preview-row">
                    <span>Capital minimum garanti</span>
                    <span>$${(amount * parseFloat(selectedCombo.capitalProtection) / 100).toFixed(2)}</span>
                </div>
                <div class="preview-row">
                    <span>Rendement annuel estimé</span>
                    <span>$${yearlyMin.toFixed(2)} - $${yearlyMax.toFixed(2)}</span>
                </div>
                <div class="preview-row">
                    <span>Rendement mensuel estimé</span>
                    <span>$${(yearlyMin/12).toFixed(2)} - $${(yearlyMax/12).toFixed(2)}</span>
                </div>
                <div class="preview-row" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <span>Répartition:</span>
                    <span></span>
                </div>
                ${selectedCombo.allocation.map(a => `
                    <div class="preview-row" style="font-size: 12px; color: #888;">
                        <span style="display: flex; align-items: center; gap: 5px;">
                            <span style="width: 8px; height: 8px; border-radius: 50%; background: ${allocationColors[a.product]}"></span>
                            ${productNames[a.product]}
                        </span>
                        <span>$${(amount * parseFloat(a.weight) / 100).toFixed(2)}</span>
                    </div>
                `).join('')}
            `;
        }

        async function confirmInvest() {
            const amount = parseFloat(document.getElementById('investAmount').value);
            if (!selectedCombo || amount < selectedCombo.minInvestment) {
                alert('Montant insuffisant');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/passive/combos/invest`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'demo-user',
                        comboId: selectedCombo.id,
                        amount: amount,
                        token: 'USDC'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert(`Investissement réussi!\n\nCombo: ${result.combo}\nMontant: $${result.totalInvested}\nAPY attendu: ${result.expectedApy}\nProtection: ${result.capitalProtection}`);
                    closeModal();
                } else {
                    alert('Erreur: ' + result.error);
                }
            } catch (error) {
                alert('Erreur de connexion au serveur');
            }
        }

        function showDetails(comboId) {
            const combo = combosData.find(c => c.id === comboId);
            const explanation = explanations[comboId];

            alert(`${combo.icon} ${combo.name}\n\n` +
                  `APY: ${combo.expectedApy}\n` +
                  `Protection: ${combo.capitalProtection}\n` +
                  `Minimum: $${combo.minInvestment}\n` +
                  `Rééquilibrage: ${combo.rebalanceFrequency}\n\n` +
                  `${explanation.what}`);
        }

        // Load combos on page load
        loadCombos();

        // Close modal on outside click
        document.getElementById('investModal').addEventListener('click', (e) => {
            if (e.target.id === 'investModal') closeModal();
        });
    </script>
</body>
</html>
