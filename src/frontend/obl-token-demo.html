<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBL Token Dashboard - Obelisk DEX</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #1a1f2e 100%);
            color: #c9d1d9;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 2px solid #30363d;
        }

        .header h1 {
            font-size: 48px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #8b949e;
            font-size: 18px;
        }

        .controls {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .controls h3 {
            color: #00ff88;
            margin-bottom: 16px;
        }

        .control-group {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .control-group input {
            flex: 1;
            padding: 12px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 14px;
        }

        .control-group button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 6px;
            color: #0d1117;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .control-group button:hover {
            transform: scale(1.05);
        }

        .control-group button.secondary {
            background: linear-gradient(135deg, #58a6ff, #4a8fd8);
        }

        .status {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #21262d;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            color: #8b949e;
            font-size: 13px;
        }

        .status-value {
            color: #00ff88;
            font-weight: bold;
            font-size: 13px;
        }

        #obl-token-dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }

        .alert {
            background: #1a1f2e;
            border: 1px solid #ffd700;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            color: #ffd700;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíé OBL Token Dashboard</h1>
        <p>Obelisk Native Token - Phase 6 Implementation Demo</p>
    </div>

    <div class="alert">
        ‚ö†Ô∏è Demo Mode - Backend must be running on localhost:3001
    </div>

    <div class="controls">
        <h3>üß™ Testing Controls</h3>

        <div class="control-group">
            <input type="number" id="add-balance-amount" placeholder="Amount of OBL to add" value="1000">
            <button onclick="addTestBalance()">Add Test Balance</button>
        </div>

        <div class="control-group">
            <input type="number" id="test-fee-amount" placeholder="Transaction amount (USD)" value="1000">
            <button class="secondary" onclick="testFeeCalculation()">Calculate Fee with OBL Discount</button>
        </div>

        <div class="status">
            <div class="status-item">
                <span class="status-label">Backend Status:</span>
                <span class="status-value" id="backend-status">Checking...</span>
            </div>
            <div class="status-item">
                <span class="status-label">OBL Module:</span>
                <span class="status-value" id="module-status">Loading...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Fee Config:</span>
                <span class="status-value" id="fee-status">Loading...</span>
            </div>
        </div>
    </div>

    <div id="obl-token-dashboard"></div>

    <!-- Load dependencies -->
    <script src="js/products/fee-config.js"></script>
    <script src="js/products/obl-token.js"></script>

    <script>
        // Check module loading
        function checkModules() {
            const oblStatus = typeof OBLToken !== 'undefined' ? '‚úì Loaded' : '‚úó Not loaded';
            const feeStatus = typeof FeeConfig !== 'undefined' ? '‚úì Loaded' : '‚úó Not loaded';

            document.getElementById('module-status').textContent = oblStatus;
            document.getElementById('module-status').style.color = typeof OBLToken !== 'undefined' ? '#00ff88' : '#f85149';

            document.getElementById('fee-status').textContent = feeStatus;
            document.getElementById('fee-status').style.color = typeof FeeConfig !== 'undefined' ? '#00ff88' : '#f85149';
        }

        // Check backend connection
        async function checkBackend() {
            try {
                const response = await fetch('http://localhost:3001/api/obl/info');
                if (response.ok) {
                    document.getElementById('backend-status').textContent = '‚úì Connected';
                    document.getElementById('backend-status').style.color = '#00ff88';
                } else {
                    document.getElementById('backend-status').textContent = '‚úó Error';
                    document.getElementById('backend-status').style.color = '#f85149';
                }
            } catch (error) {
                document.getElementById('backend-status').textContent = '‚úó Not running';
                document.getElementById('backend-status').style.color = '#f85149';
            }
        }

        // Add test balance
        function addTestBalance() {
            const amount = parseFloat(document.getElementById('add-balance-amount').value);
            if (amount && amount > 0) {
                OBLToken.addBalance(amount);
                alert(`Added ${amount} OBL to your balance!`);
                renderDashboard();
            } else {
                alert('Please enter a valid amount');
            }
        }

        // Test fee calculation
        function testFeeCalculation() {
            const amount = parseFloat(document.getElementById('test-fee-amount').value);
            if (!amount || amount <= 0) {
                alert('Please enter a valid transaction amount');
                return;
            }

            // Calculate without OBL
            const feeWithout = FeeConfig.calculateFee(amount);

            // Calculate with OBL
            const feeWith = FeeConfig.calculateFeeWithOBL(amount);

            const message = `
Transaction Amount: $${amount.toFixed(2)}

WITHOUT OBL DISCOUNT:
Fee: $${feeWithout.feeAmount.toFixed(4)} (${feeWithout.displayPercent})
You receive: $${feeWithout.netAmount.toFixed(2)}

WITH OBL DISCOUNT:
Fee: $${feeWith.feeAmount.toFixed(4)} (${feeWith.displayPercent})
You receive: $${feeWith.netAmount.toFixed(2)}
OBL Discount: ${feeWith.oblDiscountPercent}
${feeWith.oblTier ? 'Tier: ' + feeWith.oblTier.label : ''}
You save: $${feeWith.savedAmount.toFixed(4)}

Your OBL Balance: ${OBLToken.userBalance.toLocaleString()} OBL
            `.trim();

            alert(message);
        }

        // Render dashboard
        function renderDashboard() {
            OBLToken.renderDashboard('obl-token-dashboard');
        }

        // Initialize
        window.onload = function() {
            checkModules();
            checkBackend();

            // Wait for OBLToken to initialize
            setTimeout(() => {
                renderDashboard();
            }, 500);

            // Refresh backend status every 5 seconds
            setInterval(checkBackend, 5000);
        };
    </script>
</body>
</html>
