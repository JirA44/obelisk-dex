<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="combos_page_title">OBELISK - Combo Investment Products</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(100, 200, 255, 0.2);
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(90deg, #00d4ff, #7b2fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #00d4ff;
        }

        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(180deg, transparent, rgba(0, 212, 255, 0.05));
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #fff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 20px;
            color: #888;
            max-width: 800px;
            margin: 0 auto;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 60px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.3);
            margin: 20px 40px;
            border-radius: 15px;
            border: 1px solid rgba(100, 200, 255, 0.1);
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .section-title {
            text-align: center;
            padding: 40px 20px 20px;
        }

        .section-title h2 {
            font-size: 32px;
            color: #fff;
            margin-bottom: 10px;
        }

        .section-title p {
            color: #666;
        }

        .risk-filter {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .risk-btn {
            padding: 10px 25px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            background: rgba(0, 0, 0, 0.3);
            color: #aaa;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .risk-btn:hover, .risk-btn.active {
            background: linear-gradient(90deg, #00d4ff, #7b2fff);
            color: #fff;
            border-color: transparent;
        }

        .combos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
            padding: 20px 40px 60px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .combo-card {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 20px;
            border: 1px solid rgba(100, 200, 255, 0.15);
            overflow: hidden;
            transition: all 0.3s;
        }

        .combo-card:hover {
            transform: translateY(-5px);
            border-color: rgba(100, 200, 255, 0.4);
            box-shadow: 0 20px 40px rgba(0, 212, 255, 0.1);
        }

        .combo-header {
            padding: 25px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(123, 47, 255, 0.1));
            border-bottom: 1px solid rgba(100, 200, 255, 0.1);
        }

        .combo-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .combo-icon {
            font-size: 40px;
        }

        .combo-name {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }

        .combo-desc {
            color: #888;
            font-size: 14px;
            line-height: 1.5;
        }

        .combo-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px 25px;
            background: rgba(0, 0, 0, 0.2);
        }

        .combo-stat {
            text-align: center;
        }

        .combo-stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00d4ff;
        }

        .combo-stat-value.green { color: #00ff88; }
        .combo-stat-value.orange { color: #ffaa00; }
        .combo-stat-value.red { color: #ff6666; }

        .combo-stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 3px;
        }

        .combo-allocation {
            padding: 20px 25px;
        }

        .allocation-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .allocation-bar {
            display: flex;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .allocation-segment {
            transition: all 0.3s;
        }

        .allocation-segment:hover {
            filter: brightness(1.3);
        }

        .allocation-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: #888;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .combo-explanation {
            padding: 20px 25px;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .explanation-title {
            font-size: 14px;
            color: #00d4ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explanation-text {
            font-size: 13px;
            color: #999;
            line-height: 1.6;
        }

        .combo-howto {
            padding: 20px 25px;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
        }

        .howto-title {
            font-size: 14px;
            color: #7b2fff;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .howto-steps {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .howto-step {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 12px;
            color: #888;
        }

        .step-number {
            background: linear-gradient(135deg, #00d4ff, #7b2fff);
            color: #fff;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .combo-actions {
            padding: 20px 25px;
            display: flex;
            gap: 10px;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
        }

        .btn-invest {
            flex: 1;
            padding: 12px;
            background: linear-gradient(90deg, #00d4ff, #7b2fff);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-invest:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3);
        }

        .btn-details {
            padding: 12px 20px;
            background: transparent;
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 10px;
            color: #aaa;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-details:hover {
            border-color: #00d4ff;
            color: #00d4ff;
        }

        .risk-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 10px;
        }

        .risk-minimal { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .risk-low { background: rgba(0, 200, 255, 0.2); color: #00d4ff; }
        .risk-low-medium { background: rgba(255, 200, 0, 0.2); color: #ffc800; }
        .risk-medium { background: rgba(255, 150, 0, 0.2); color: #ff9600; }
        .risk-medium-high { background: rgba(255, 100, 100, 0.2); color: #ff6464; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a3a, #0a0a2a);
            border-radius: 20px;
            border: 1px solid rgba(100, 200, 255, 0.2);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(100, 200, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: #666;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 25px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #888;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 200, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 18px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .investment-preview {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .preview-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .preview-row:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #00d4ff;
        }

        .footer {
            text-align: center;
            padding: 40px;
            color: #444;
            border-top: 1px solid rgba(100, 200, 255, 0.1);
        }

        @media (max-width: 768px) {
            .combos-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .hero h1 {
                font-size: 32px;
            }

            .stats-bar {
                flex-direction: column;
                gap: 20px;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">OBELISK</div>
        <nav class="nav-links">
            <a href="index.html" data-i18n="trade">Trading</a>
            <a href="app.html">App</a>
            <a href="tools.html" data-i18n="tools">Tools</a>
            <a href="combos.html" class="active" data-i18n="combos">Combos</a>
            <a href="docs.html">Docs</a>
        </nav>
    </header>

    <section class="hero">
        <h1 data-i18n="combos_hero_title">Combo Investment Products</h1>
        <p data-i18n="combos_hero_desc">Combined investment strategies - Automatic multi-product diversification with capital protection. Invest in one click in portfolios optimized by experts.</p>
    </section>

    <div class="stats-bar">
        <div class="stat">
            <div class="stat-value">14</div>
            <div class="stat-label" data-i18n="combos_strategies_available">Strategies Available</div>
        </div>
        <div class="stat">
            <div class="stat-value">4-20%</div>
            <div class="stat-label" data-i18n="combos_apy_range">APY Range</div>
        </div>
        <div class="stat">
            <div class="stat-value">60-100%</div>
            <div class="stat-label" data-i18n="combos_capital_protection">Capital Protection</div>
        </div>
        <div class="stat">
            <div class="stat-value">$50</div>
            <div class="stat-label" data-i18n="combos_min_invest">Min Investment</div>
        </div>
    </div>

    <div class="section-title">
        <h2 data-i18n="combos_choose_strategy">Choose Your Strategy</h2>
        <p data-i18n="combos_filter_risk">Filter by risk level</p>
    </div>

    <div class="risk-filter">
        <button class="risk-btn active" onclick="filterByRisk('all')" data-i18n="combos_all">All</button>
        <button class="risk-btn" onclick="filterByRisk('Minimal')" data-i18n="combos_minimal">Minimal</button>
        <button class="risk-btn" onclick="filterByRisk('Low')" data-i18n="combos_low">Low</button>
        <button class="risk-btn" onclick="filterByRisk('Low-Medium')" data-i18n="combos_low_medium">Low-Medium</button>
        <button class="risk-btn" onclick="filterByRisk('Medium')" data-i18n="combos_medium">Medium</button>
        <button class="risk-btn" onclick="filterByRisk('Medium-High')" data-i18n="combos_medium_high">Medium-High</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- AERODROME FINANCE ‚Äî Base Chain ‚Äî 1-Click Real Invest      -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="aerodromeSection" style="max-width:1600px;margin:0 auto 40px;padding:0 40px;">

        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;">
            <div>
                <h2 style="font-size:28px;color:#fff;margin-bottom:6px;">
                    üî¥ Aerodrome Finance
                    <span style="font-size:14px;background:linear-gradient(90deg,#0052ff,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-left:8px;">Base Chain ‚Äî LIVE</span>
                </h2>
                <p style="color:#666;font-size:14px;">Pools r√©els ¬∑ TVL ‚â• $50k ¬∑ Tri√©s par APY ¬∑ 1-clic = Bridge + Swap + LP</p>
            </div>
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <div id="aeroBalanceChip" style="background:rgba(0,82,255,0.15);border:1px solid rgba(0,82,255,0.4);border-radius:20px;padding:8px 16px;font-size:13px;color:#00d4ff;cursor:pointer;" onclick="loadAeroBalances()">
                    Wallet: <span id="aeroBalText">chargement...</span>
                </div>
                <button onclick="loadAerodromePools()" style="padding:8px 20px;background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.4);color:#00d4ff;border-radius:20px;cursor:pointer;font-size:13px;">
                    Refresh
                </button>
                <select id="aeroFilterStable" onchange="loadAerodromePools()" style="background:#1a1a3a;border:1px solid rgba(100,200,255,0.3);color:#aaa;padding:8px 14px;border-radius:20px;cursor:pointer;font-size:13px;">
                    <option value="">Tous types</option>
                    <option value="false">Volatile (haut APY)</option>
                    <option value="true">Stable (faible IL)</option>
                </select>
            </div>
        </div>

        <div id="aeroPoolsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:20px;">
            <div style="grid-column:1/-1;text-align:center;padding:40px;color:#666;">
                Chargement des pools Aerodrome...
            </div>
        </div>
    </div>

    <!-- Aerodrome Invest Modal -->
    <div id="aeroModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:1000;align-items:center;justify-content:center;">
        <div style="background:#0f0f2a;border:1px solid rgba(0,212,255,0.3);border-radius:20px;padding:32px;max-width:480px;width:90%;position:relative;">
            <button onclick="closeAeroModal()" style="position:absolute;top:16px;right:16px;background:none;border:none;color:#666;font-size:24px;cursor:pointer;">&times;</button>
            <h3 id="aeroModalTitle" style="color:#fff;margin-bottom:6px;font-size:20px;">Invest in Pool</h3>
            <p id="aeroModalSub" style="color:#666;font-size:13px;margin-bottom:24px;"></p>

            <div style="background:rgba(0,82,255,0.08);border:1px solid rgba(0,82,255,0.2);border-radius:12px;padding:16px;margin-bottom:20px;">
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px;">
                    <span style="color:#888;">APY</span><span id="aeroModalApy" style="color:#00ff88;font-weight:bold;"></span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px;">
                    <span style="color:#888;">TVL</span><span id="aeroModalTvl" style="color:#fff;"></span>
                </div>
                <div style="display:flex;justify-content:space-between;font-size:13px;">
                    <span style="color:#888;">Type</span><span id="aeroModalType" style="color:#fff;"></span>
                </div>
            </div>

            <div style="margin-bottom:20px;">
                <label style="color:#aaa;font-size:13px;display:block;margin-bottom:8px;">Montant ($USD)</label>
                <input type="number" id="aeroAmount" value="1" min="0.5" step="0.5"
                    style="width:100%;background:#1a1a3a;border:1px solid rgba(0,212,255,0.3);color:#fff;padding:12px 16px;border-radius:10px;font-size:18px;"
                    oninput="updateAeroPreview()">
            </div>

            <div id="aeroFlowPreview" style="background:rgba(0,0,0,0.3);border-radius:10px;padding:14px;margin-bottom:20px;font-size:12px;color:#888;line-height:1.8;">
                <!-- Flow steps will appear here -->
            </div>

            <div id="aeroInvestResult" style="display:none;"></div>

            <div style="display:flex;gap:10px;">
                <button onclick="executeAeroInvest(true)" style="flex:1;padding:14px;background:linear-gradient(90deg,#8a2be2,#5a1dbe);border:none;color:#fff;border-radius:12px;cursor:pointer;font-weight:bold;font-size:14px;">
                    üéÆ Simuler
                </button>
                <button onclick="executeAeroInvest(false)" style="flex:1;padding:14px;background:linear-gradient(90deg,#0052ff,#00d4ff);border:none;color:#fff;border-radius:12px;cursor:pointer;font-weight:bold;font-size:14px;">
                    üíé Investir $<span id="aeroRealBtn">1</span> R√âEL
                </button>
            </div>
            <p style="text-align:center;color:#555;font-size:11px;margin-top:12px;">Flow: Bridge (si besoin) ‚Üí Swap 50/50 ‚Üí AddLiquidity Aerodrome</p>
        </div>
    </div>

    <div class="combos-grid" id="combosGrid">
        <!-- Combos will be loaded here -->
    </div>

    <!-- Investment Modal -->
    <div class="modal" id="investModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle" data-i18n="invest">Invest</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label data-i18n="amount_usdc">Amount (USDC)</label>
                    <input type="number" id="investAmount" placeholder="1000" oninput="updatePreview()">
                </div>
                <div class="investment-preview" id="investmentPreview">
                    <!-- Preview will be shown here -->
                </div>
                <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-invest" style="flex: 1; background: linear-gradient(90deg, #8a2be2, #9b59b6);" onclick="confirmInvest(true)" data-i18n="invest_simulated">
                            üéÆ Investir (Simul√©)
                        </button>
                        <button class="btn-invest" style="flex: 1;" onclick="confirmInvest(false)" data-i18n="invest_real">
                            üíé Investir (R√©el)
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-details" style="flex: 1; border-color: #8a2be2; color: #8a2be2;" onclick="withdrawInvest(true)" data-i18n="withdraw_simulated">
                            üì§ Retirer (Simul√©)
                        </button>
                        <button class="btn-details" style="flex: 1; border-color: #00d4ff; color: #00d4ff;" onclick="withdrawInvest(false)" data-i18n="withdraw_real">
                            üì§ Retirer (R√©el)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>OBELISK DEX - Non-Custodial Trading Platform</p>
        <p style="margin-top: 10px; font-size: 12px;" data-i18n="combos_disclaimer">Past returns do not guarantee future returns. Invest responsibly.</p>
    </footer>

    <script src="js/config.js"></script>
    <script src="js/core/i18n.js"></script>
    <script>
        const API_BASE = ObeliskConfig.getApiUrl();
        let combosData = [];
        let selectedCombo = null;

        // Helper function for translations
        function t(key) {
            return (typeof I18n !== 'undefined' && I18n.t) ? I18n.t(key) : key;
        }

        const allocationColors = {
            vault: '#00d4ff',
            bond: '#7b2fff',
            staking: '#00ff88',
            yield: '#ffc800',
            index: '#ff6464',
            dca: '#ff00ff',
            insurance: '#888888'
        };

        // Product names will use i18n
        function getProductName(type) {
            const names = {
                vault: t('combos_product_vault'),
                bond: t('combos_product_bond'),
                staking: t('combos_product_staking'),
                yield: t('combos_product_yield'),
                index: t('combos_product_index'),
                dca: t('combos_product_dca'),
                insurance: t('combos_product_insurance')
            };
            return names[type] || type;
        }

        const explanations = {
            'SAFE_HAVEN': {
                what: "Safe Haven combine 3 produits ultra-s√©curis√©s: un vault de stablecoins (60%), des obligations Treasury (30%), et une assurance DeFi (10%). Votre capital est 100% prot√©g√© - vous ne pouvez pas perdre d'argent.",
                howto: [
                    "Connectez votre wallet et d√©posez des USDC",
                    "Choisissez le montant (min $100)",
                    "Vos fonds sont automatiquement r√©partis dans les 3 produits",
                    "Les int√©r√™ts s'accumulent quotidiennement",
                    "Retirez √† tout moment sans p√©nalit√©"
                ]
            },
            'STABLE_MAXIMIZER': {
                what: "Stable Maximizer optimise le rendement sur stablecoins en combinant le Yield Optimizer (50%), des Corporate Bonds (30%), et un Vault stable (20%). Z√©ro exposition crypto, rendement maximis√©.",
                howto: [
                    "D√©posez minimum $500 en USDC",
                    "Le Yield Optimizer cherche les meilleurs taux automatiquement",
                    "Les bonds ajoutent un revenu fixe garanti",
                    "R√©√©quilibrage hebdomadaire automatique",
                    "Retrait possible √† tout moment"
                ]
            },
            'BALANCED_GROWTH': {
                what: "Balanced Growth offre une croissance √©quilibr√©e: 40% en vault stable, 20% staking ETH, 25% index conservateur, 15% bonds. Exposition crypto limit√©e (30%) avec 85% de protection.",
                howto: [
                    "Investissez minimum $250",
                    "Votre capital est diversifi√© sur 4 produits",
                    "L'ETH stak√© g√©n√®re des r√©compenses continues",
                    "L'index suit les meilleures cryptos prudemment",
                    "R√©√©quilibrage hebdomadaire pour maintenir les ratios"
                ]
            },
            'SMART_SAVER': {
                what: "Smart Saver est con√ßu pour les √©pargnants intelligents: 45% yield optimizer, 25% vault Blue Chip (ETH/BTC), 20% DCA Bitcoin hebdomadaire, 10% assurance. 90% de protection du capital.",
                howto: [
                    "D√©posez minimum $200",
                    "Le DCA ach√®te automatiquement du BTC chaque semaine",
                    "Le vault Blue Chip expose aux majors avec protection",
                    "L'assurance prot√®ge contre les risques smart contract",
                    "Surveillez la croissance de votre portefeuille BTC"
                ]
            },
            'BLUE_CHIP_COMBO': {
                what: "Blue Chip Combo maximise l'exposition aux cryptos majeures: 35% staking ETH, 30% vault BTC/ETH, 25% DCA mix, 10% bonds. Id√©al pour accumuler BTC et ETH avec rendement.",
                howto: [
                    "Investissez minimum $500",
                    "35% de vos fonds stakent de l'ETH (4.2% APY)",
                    "Le DCA ach√®te 50% BTC / 50% ETH chaque semaine",
                    "Le vault prot√®ge vos positions Blue Chip",
                    "Parfait pour une strat√©gie d'accumulation long terme"
                ]
            },
            'YIELD_HUNTER': {
                what: "Yield Hunter chasse les meilleurs rendements: 35% Multi-Chain Optimizer, 25% High Yield Bonds (12% APY), 20% staking SOL, 20% staking ATOM. Rendements 8-15% avec 75% protection.",
                howto: [
                    "Minimum $1000 requis",
                    "Le Multi-Chain cherche les meilleurs yields cross-chain",
                    "Les High Yield Bonds offrent 12% garanti sur 60 jours",
                    "SOL et ATOM sont stak√©s pour maximiser les r√©compenses",
                    "R√©√©quilibrage quotidien pour optimiser les rendements"
                ]
            },
            'TOTAL_DIVERSIFIED': {
                what: "Total Diversified utilise TOUS les 7 produits: vault, staking, bonds, index, yield optimizer, DCA, et assurance. Diversification maximale avec 82% de protection du capital.",
                howto: [
                    "Investissez minimum $1000",
                    "Vos fonds sont r√©partis sur 7 produits diff√©rents",
                    "L'index Top 10 suit les meilleures cryptos",
                    "Le DCA diversifi√© accumule BTC, ETH, SOL, LINK",
                    "L'assurance prot√®ge l'ensemble du portefeuille"
                ]
            },
            'DEFI_EXPLORER': {
                what: "DeFi Explorer vous expose au monde DeFi: 30% index DeFi (UNI, AAVE, etc.), 25% vault DeFi Safe, 25% Multi-Chain yield, 20% Corporate Bonds. Pour les enthousiastes DeFi avec filet de s√©curit√©.",
                howto: [
                    "D√©posez minimum $500",
                    "L'index DeFi vous expose aux leaders du secteur",
                    "Le vault DeFi Safe prot√®ge vos positions",
                    "Le yield farming cross-chain optimise les rendements",
                    "R√©√©quilibrage quotidien selon les conditions du march√©"
                ]
            },
            'PASSIVE_INCOME': {
                what: "Passive Income g√©n√®re un revenu mensuel stable: 35% Treasury Bonds, 25% Corporate Bonds, 25% Stable Vault, 15% Yield Optimizer. 95% protection pour un revenu r√©gulier.",
                howto: [
                    "Investissez minimum $1000",
                    "60% en obligations garantissent un revenu fixe",
                    "Les int√©r√™ts sont distribu√©s mensuellement",
                    "Parfait pour compl√©ter vos revenus",
                    "Retirez les int√©r√™ts ou r√©investissez automatiquement"
                ]
            },
            'RETIREMENT_BUILDER': {
                what: "Retirement Builder est con√ßu pour le long terme: 40% Treasury 90 jours, 30% Stable Vault, 20% Stable Income Index, 10% Full Insurance. 98% protection ultra-conservatrice.",
                howto: [
                    "Investissez minimum $5000",
                    "Strat√©gie optimis√©e pour 5+ ans d'investissement",
                    "Les Treasury 90j offrent les meilleurs taux garantis",
                    "L'assurance compl√®te prot√®ge tout votre portefeuille",
                    "Laissez les int√©r√™ts compos√©s travailler pour vous"
                ]
            },
            'L2_OPPORTUNITY': {
                what: "L2 Opportunity se concentre sur Layer 2: 35% index L2 (ARB, OP, MATIC), 30% Emerging Vault, 20% staking MATIC, 15% bonds. Pour parier sur l'adoption des L2.",
                howto: [
                    "D√©posez minimum $300",
                    "L'index L2 suit les performances de ARB, OP, MATIC, IMX, LRC",
                    "Le staking MATIC g√©n√®re 5.5% de r√©compenses",
                    "Le vault Emerging prot√®ge avec 90% de garantie",
                    "R√©√©quilibrage quotidien pour capturer les opportunit√©s"
                ]
            },
            'STAKING_MASTER': {
                what: "Staking Master optimise le staking multi-chain: 30% ETH, 25% SOL, 20% ATOM, 15% AVAX, 10% vault stable. Recevez des tokens liquides (stETH, stSOL, etc.) tradables.",
                howto: [
                    "Investissez minimum $500",
                    "Recevez stETH, stSOL, stATOM, stAVAX en √©change",
                    "Ces tokens sont liquides - vous pouvez les trader",
                    "Les r√©compenses de staking s'accumulent automatiquement",
                    "Le vault stable sert de r√©serve de s√©curit√©"
                ]
            },
            'ULTRA_CONSERVATIVE': {
                what: "Ultra Conservative est le plus s√ªr: 50% Treasury 7j, 40% Stable Vault, 10% assurance depeg. 100% protection garantie, id√©al pour les investisseurs tr√®s prudents ou les d√©butants.",
                howto: [
                    "Investissez d√®s $50 seulement",
                    "Les Treasury 7j sont les plus s√ªrs du march√©",
                    "L'assurance depeg prot√®ge si un stablecoin d√©vie",
                    "R√©√©quilibrage quotidien automatique",
                    "Parfait pour d√©couvrir l'investissement crypto sans risque"
                ]
            },
            'AGGRESSIVE_YIELD': {
                what: "Aggressive Yield maximise les rendements: 30% High Yield Bonds (12%), 30% Multi-Chain (10%), 20% staking ATOM (8.2%), 20% DeFi Index. Pour les investisseurs exp√©riment√©s cherchant 12-20% APY.",
                howto: [
                    "Minimum $2000 requis - strat√©gie avanc√©e",
                    "60% de protection signifie plus de risque",
                    "Les rendements √©lev√©s compensent la volatilit√©",
                    "R√©√©quilibrage quotidien pour maximiser les gains",
                    "Recommand√© pour les investisseurs exp√©riment√©s uniquement"
                ]
            }
        };

        async function loadCombos() {
            try {
                const response = await fetch(`${API_BASE}/api/passive/combos`);
                const data = await response.json();
                combosData = data.combos;
                renderCombos(combosData);
            } catch (error) {
                console.error('Error loading combos:', error);
                document.getElementById('combosGrid').innerHTML = `<p style="text-align:center;color:#ff6464;">${t('combos_load_error')}</p>`;
            }
        }

        function renderCombos(combos) {
            const grid = document.getElementById('combosGrid');
            grid.innerHTML = combos.map(combo => {
                const explanation = explanations[combo.id] || { what: combo.description, howto: [t('combos_invest_default')] };
                const riskClass = combo.riskLevel.toLowerCase().replace(' ', '-').replace('/', '-');

                return `
                    <div class="combo-card" data-risk="${combo.riskLevel}">
                        <div class="combo-header">
                            <div class="combo-title">
                                <span class="combo-icon">${combo.icon}</span>
                                <span class="combo-name">${combo.name}</span>
                            </div>
                            <div class="combo-desc">${combo.description}</div>
                            <span class="risk-badge risk-${riskClass}">${combo.riskLevel}</span>
                        </div>

                        <div class="combo-stats">
                            <div class="combo-stat">
                                <div class="combo-stat-value green">${combo.expectedApy}</div>
                                <div class="combo-stat-label">${t('combos_expected_apy')}</div>
                            </div>
                            <div class="combo-stat">
                                <div class="combo-stat-value">${combo.capitalProtection}</div>
                                <div class="combo-stat-label">${t('combos_protection')}</div>
                            </div>
                            <div class="combo-stat">
                                <div class="combo-stat-value">$${combo.minInvestment}</div>
                                <div class="combo-stat-label">${t('combos_minimum')}</div>
                            </div>
                        </div>

                        <div class="combo-allocation">
                            <div class="allocation-title">${t('combos_allocation')}</div>
                            <div class="allocation-bar">
                                ${combo.allocation.map(a => `
                                    <div class="allocation-segment"
                                         style="width: ${a.weight}; background: ${allocationColors[a.product]}"
                                         title="${getProductName(a.product)}: ${a.weight}">
                                    </div>
                                `).join('')}
                            </div>
                            <div class="allocation-legend">
                                ${combo.allocation.map(a => `
                                    <div class="legend-item">
                                        <div class="legend-dot" style="background: ${allocationColors[a.product]}"></div>
                                        ${getProductName(a.product)} ${a.weight}
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="combo-explanation">
                            <div class="explanation-title">
                                <span>&#128161;</span> ${t('combos_what_is_it')}
                            </div>
                            <div class="explanation-text">${explanation.what}</div>
                        </div>

                        <div class="combo-howto">
                            <div class="howto-title">
                                <span>&#128736;</span> ${t('combos_how_it_works')}
                            </div>
                            <div class="howto-steps">
                                ${explanation.howto.map((step, i) => `
                                    <div class="howto-step">
                                        <span class="step-number">${i + 1}</span>
                                        <span>${step}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="combo-actions">
                            <button class="btn-invest" onclick="openInvestModal('${combo.id}')">
                                ${t('combos_invest_now')}
                            </button>
                            <button class="btn-details" onclick="showDetails('${combo.id}')">
                                ${t('combos_details')}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterByRisk(risk) {
            document.querySelectorAll('.risk-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (risk === 'all') {
                renderCombos(combosData);
            } else {
                const filtered = combosData.filter(c => c.riskLevel === risk);
                renderCombos(filtered);
            }
        }

        function openInvestModal(comboId) {
            selectedCombo = combosData.find(c => c.id === comboId);
            if (!selectedCombo) return;

            document.getElementById('modalTitle').textContent = `Investir dans ${selectedCombo.name}`;
            document.getElementById('investAmount').value = selectedCombo.minInvestment;
            updatePreview();
            document.getElementById('investModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('investModal').classList.remove('active');
        }

        function updatePreview() {
            if (!selectedCombo) return;

            const amount = parseFloat(document.getElementById('investAmount').value) || 0;
            const preview = document.getElementById('investmentPreview');

            if (amount < selectedCombo.minInvestment) {
                preview.innerHTML = `<p style="color: #ff6464;">${t('combos_min_required')}: $${selectedCombo.minInvestment}</p>`;
                return;
            }

            const apyMin = parseFloat(selectedCombo.expectedApy.split('-')[0]);
            const apyMax = parseFloat(selectedCombo.expectedApy.split('-')[1]);
            const yearlyMin = amount * apyMin / 100;
            const yearlyMax = amount * apyMax / 100;

            preview.innerHTML = `
                <div class="preview-row">
                    <span>${t('combos_amount_invested')}</span>
                    <span>$${amount.toFixed(2)}</span>
                </div>
                <div class="preview-row">
                    <span>${t('combos_capital_protection')}</span>
                    <span>${selectedCombo.capitalProtection}</span>
                </div>
                <div class="preview-row">
                    <span>${t('combos_min_guaranteed')}</span>
                    <span>$${(amount * parseFloat(selectedCombo.capitalProtection) / 100).toFixed(2)}</span>
                </div>
                <div class="preview-row">
                    <span>${t('combos_yearly_estimate')}</span>
                    <span>$${yearlyMin.toFixed(2)} - $${yearlyMax.toFixed(2)}</span>
                </div>
                <div class="preview-row">
                    <span>${t('combos_monthly_estimate')}</span>
                    <span>$${(yearlyMin/12).toFixed(2)} - $${(yearlyMax/12).toFixed(2)}</span>
                </div>
                <div class="preview-row" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <span>${t('combos_allocation')}:</span>
                    <span></span>
                </div>
                ${selectedCombo.allocation.map(a => `
                    <div class="preview-row" style="font-size: 12px; color: #888;">
                        <span style="display: flex; align-items: center; gap: 5px;">
                            <span style="width: 8px; height: 8px; border-radius: 50%; background: ${allocationColors[a.product]}"></span>
                            ${getProductName(a.product)}
                        </span>
                        <span>$${(amount * parseFloat(a.weight) / 100).toFixed(2)}</span>
                    </div>
                `).join('')}
            `;
        }

        async function confirmInvest(isSimulated = true) {
            const amount = parseFloat(document.getElementById('investAmount').value);
            if (!selectedCombo || amount < selectedCombo.minInvestment) {
                alert(t('combos_insufficient_amount'));
                return;
            }

            const type = isSimulated ? 'üéÆ Simul√©' : 'üíé R√©el';

            try {
                const response = await fetch(`${API_BASE}/api/passive/combos/invest`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'demo-user',
                        comboId: selectedCombo.id,
                        amount: amount,
                        token: 'USDC',
                        isSimulated: isSimulated
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert(`${type} - ${t('combos_invest_success')}!\n\nCombo: ${result.combo}\n${t('amount')}: $${result.totalInvested}\n${t('combos_expected_apy')}: ${result.expectedApy}\n${t('combos_protection')}: ${result.capitalProtection}`);
                    closeModal();
                } else {
                    alert(t('error_occurred') + ': ' + result.error);
                }
            } catch (error) {
                alert(t('combos_server_error'));
            }
        }

        async function withdrawInvest(isSimulated = true) {
            if (!selectedCombo) {
                alert('Aucun combo s√©lectionn√©');
                return;
            }

            const type = isSimulated ? 'üéÆ Simul√©' : 'üíé R√©el';

            try {
                const response = await fetch(`${API_BASE}/api/passive/combos/withdraw`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'demo-user',
                        comboId: selectedCombo.id,
                        isSimulated: isSimulated
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert(`${type} - Retrait effectu√©!\n\nCombo: ${selectedCombo.name}\nMontant retir√©: $${result.amountWithdrawn || 0}\nGains: $${result.earnings || 0}`);
                    closeModal();
                } else {
                    alert('Erreur: ' + (result.error || 'Aucun investissement trouv√©'));
                }
            } catch (error) {
                alert('Erreur serveur lors du retrait');
            }
        }

        function showDetails(comboId) {
            const combo = combosData.find(c => c.id === comboId);
            const explanation = explanations[comboId];

            alert(`${combo.icon} ${combo.name}\n\n` +
                  `APY: ${combo.expectedApy}\n` +
                  `${t('combos_protection')}: ${combo.capitalProtection}\n` +
                  `${t('combos_minimum')}: $${combo.minInvestment}\n` +
                  `${t('combos_rebalance')}: ${combo.rebalanceFrequency}\n\n` +
                  `${explanation.what}`);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // AERODROME FINANCE ‚Äî 1-Click Invest Logic
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let aeroCurrentPool = null;

        async function loadAerodromePools() {
            const grid = document.getElementById('aeroPoolsGrid');
            grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#666;">Chargement des pools Aerodrome en direct (DeFi Llama)...</div>';

            const stableFilter = document.getElementById('aeroFilterStable').value;

            try {
                // Call DeFi Llama directly ‚Äî CORS-enabled, works from any origin
                const ctrl2 = new AbortController();
                const tid2  = setTimeout(() => ctrl2.abort(), 20000);
                const resp = await fetch('https://yields.llama.fi/pools', { signal: ctrl2.signal });
                clearTimeout(tid2);
                if (!resp.ok) throw new Error(`DeFi Llama HTTP ${resp.status}`);
                const raw = await resp.json();

                const MIN_TVL = 50000;
                let pools = (raw.data || []).filter(p =>
                    (p.project || '').toLowerCase().includes('aerodrome') &&
                    p.chain === 'Base' &&
                    (p.tvlUsd || 0) >= MIN_TVL &&
                    p.apy != null &&
                    p.status !== 'dead'
                );

                if (stableFilter === 'true')  pools = pools.filter(p => p.poolMeta?.includes('stable'));
                if (stableFilter === 'false') pools = pools.filter(p => !p.poolMeta?.includes('stable'));

                pools = pools
                    .sort((a, b) => (b.apy || 0) - (a.apy || 0))
                    .slice(0, 100)
                    .map((p, i) => ({
                        rank:         i + 1,
                        poolId:       p.pool,
                        symbol:       p.symbol,
                        tvlUsd:       Math.round(p.tvlUsd || 0),
                        apy:          parseFloat((p.apy  || 0).toFixed(2)),
                        apyBase:      parseFloat((p.apyBase  || 0).toFixed(2)),
                        apyReward:    parseFloat((p.apyReward || 0).toFixed(2)),
                        stable:       !!(p.poolMeta?.includes('stable')),
                        ilRisk:       p.ilRisk || 'no',
                        rewardTokens: p.rewardTokens || [],
                        tokens:       p.underlyingTokens || [],
                        project:      p.project,
                    }));

                if (!pools.length) {
                    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#ff6666;">Aucun pool trouv√©.</div>';
                    return;
                }

                grid.innerHTML = pools.map(pool => renderAeroCard(pool)).join('');

            } catch (err) {
                grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;color:#ff6666;">Erreur: ${err.message} <br><button onclick="loadAerodromePools()" style="margin-top:12px;padding:8px 20px;background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.4);color:#00d4ff;border-radius:20px;cursor:pointer;">‚Üª R√©essayer</button></div>`;
            }
        }

        function fmtApy(apy) {
            if (apy > 9999) return `${(apy/1000).toFixed(0)}k%`;
            if (apy > 999)  return `${apy.toFixed(0)}%`;
            return `${apy.toFixed(1)}%`;
        }

        function renderAeroCard(pool) {
            const isCL     = pool.project === 'aerodrome-slipstream';
            const apyColor = pool.apy > 1000 ? '#ff4444' : pool.apy > 100 ? '#ff9900' : pool.apy > 20 ? '#ffd700' : '#00ff88';
            const tvlFmt   = pool.tvlUsd >= 1e6 ? `$${(pool.tvlUsd/1e6).toFixed(1)}M` : `$${(pool.tvlUsd/1e3).toFixed(0)}k`;
            const badge    = pool.stable ? '‚öñÔ∏è Stable' : '‚ö° Volatile';
            const badgeClr = pool.stable ? 'rgba(0,255,136,0.15)' : 'rgba(255,170,0,0.15)';
            const badgeBdr = pool.stable ? 'rgba(0,255,136,0.4)'  : 'rgba(255,170,0,0.4)';
            const clBadge  = isCL ? `<span style="background:rgba(138,43,226,0.2);border:1px solid rgba(138,43,226,0.5);border-radius:6px;padding:2px 8px;font-size:11px;color:#cc88ff;">CL</span>` : '';
            const ilBadge  = pool.ilRisk === 'no' ? '' : `<span style="background:rgba(255,100,100,0.15);border:1px solid rgba(255,100,100,0.4);border-radius:6px;padding:2px 8px;font-size:11px;color:#ff9999;">‚ö†Ô∏è IL</span>`;
            const rewardBadge = (pool.rewardTokens||[]).length > 0
                ? '<span style="background:rgba(255,60,0,0.15);border:1px solid rgba(255,60,0,0.4);border-radius:6px;padding:2px 8px;font-size:11px;color:#ff6644;">üî¥ AERO</span>' : '';
            const poolJSON = JSON.stringify(pool).replace(/"/g,'&quot;');
            const btnLabel = isCL ? 'üîó Aerodrome' : '+ Invest';
            const btnStyle = isCL
                ? 'padding:8px 18px;background:rgba(138,43,226,0.3);border:1px solid rgba(138,43,226,0.5);color:#cc88ff;border-radius:20px;cursor:pointer;font-size:13px;'
                : 'padding:8px 18px;background:linear-gradient(90deg,#0052ff,#00d4ff);border:none;color:#fff;border-radius:20px;cursor:pointer;font-size:13px;font-weight:bold;';
            const rankColor = pool.rank <= 3 ? '#ffd700' : '#555';

            return `
            <div style="background:rgba(15,15,40,0.9);border:1px solid rgba(0,82,255,0.2);border-radius:16px;overflow:hidden;transition:all 0.3s;cursor:pointer;"
                 onmouseover="this.style.borderColor='rgba(0,82,255,0.6)';this.style.transform='translateY(-3px)'"
                 onmouseout="this.style.borderColor='rgba(0,82,255,0.2)';this.style.transform=''"
                 onclick="${isCL ? `window.open('https://aerodrome.finance/liquidity','_blank')` : `openAeroModal(${poolJSON})`}">

                <div style="padding:16px 20px;background:linear-gradient(135deg,rgba(0,82,255,0.08),rgba(0,212,255,0.05));">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
                        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                            <span style="font-size:13px;font-weight:bold;color:${rankColor};">#${pool.rank}</span>
                            <span style="font-weight:bold;color:#fff;font-size:15px;">${pool.symbol}</span>
                            <span style="background:${badgeClr};border:1px solid ${badgeBdr};border-radius:6px;padding:2px 7px;font-size:10px;color:#aaa;">${badge}</span>
                            ${clBadge}
                        </div>
                        <span style="font-size:20px;font-weight:bold;color:${apyColor};">${fmtApy(pool.apy)}</span>
                    </div>
                    <div style="display:flex;gap:5px;flex-wrap:wrap;">${ilBadge}${rewardBadge}</div>
                </div>

                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:rgba(255,255,255,0.04);">
                    <div style="padding:11px 14px;background:#0d0d26;text-align:center;">
                        <div style="font-size:16px;font-weight:bold;color:${apyColor};">${fmtApy(pool.apy)}</div>
                        <div style="font-size:10px;color:#555;margin-top:2px;">APY total</div>
                    </div>
                    <div style="padding:11px 14px;background:#0d0d26;text-align:center;">
                        <div style="font-size:16px;font-weight:bold;color:#00d4ff;">${tvlFmt}</div>
                        <div style="font-size:10px;color:#555;margin-top:2px;">TVL</div>
                    </div>
                    <div style="padding:11px 14px;background:#0d0d26;text-align:center;">
                        <div style="font-size:16px;font-weight:bold;color:#aaa;">${pool.apyBase.toFixed(1)}%</div>
                        <div style="font-size:10px;color:#555;margin-top:2px;">Fees APY</div>
                    </div>
                </div>

                <div style="padding:12px 18px;display:flex;align-items:center;justify-content:space-between;">
                    <div style="font-size:11px;color:#555;">
                        AERO: <span style="color:#ff6644;">${fmtApy(pool.apyReward)}</span>
                        ${isCL ? '<span style="color:#cc88ff;margin-left:8px;">¬∑ CL tick range</span>' : ''}
                    </div>
                    <button onclick="event.stopPropagation();${isCL ? `window.open('https://aerodrome.finance/liquidity','_blank')` : `openAeroModal(${poolJSON})`}"
                        style="${btnStyle}">
                        ${btnLabel}
                    </button>
                </div>
            </div>`;
        }

        async function loadAeroBalances() {
            document.getElementById('aeroBalText').textContent = '...';
            const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            if (!isLocal) {
                document.getElementById('aeroBalText').textContent = 'local only';
                return;
            }
            try {
                const resp = await fetch('http://localhost:3001/api/aerodrome/balances');
                const data = await resp.json();
                if (data.success) {
                    document.getElementById('aeroBalText').textContent =
                        `Base $${data.base.total_USD} | Arb $${data.arbitrum.ETH_USD}`;
                } else {
                    document.getElementById('aeroBalText').textContent = 'Erreur';
                }
            } catch {
                document.getElementById('aeroBalText').textContent = 'Hors ligne';
            }
        }

        function openAeroModal(pool) {
            aeroCurrentPool = pool;
            document.getElementById('aeroModalTitle').textContent = `${pool.symbol}`;
            document.getElementById('aeroModalSub').textContent = `Pool Aerodrome Finance ‚Äî Base Chain`;
            document.getElementById('aeroModalApy').textContent = `${pool.apy}% APY`;
            document.getElementById('aeroModalTvl').textContent = pool.tvlUsd >= 1e6
                ? `$${(pool.tvlUsd/1e6).toFixed(2)}M` : `$${(pool.tvlUsd/1e3).toFixed(0)}k`;
            document.getElementById('aeroModalType').textContent = pool.stable ? '‚öñÔ∏è Stable (faible IL)' : '‚ö° Volatile';
            document.getElementById('aeroInvestResult').style.display = 'none';
            updateAeroPreview();
            document.getElementById('aeroModal').style.display = 'flex';
        }

        function closeAeroModal() {
            document.getElementById('aeroModal').style.display = 'none';
            aeroCurrentPool = null;
        }

        function updateAeroPreview() {
            const amount = parseFloat(document.getElementById('aeroAmount').value) || 1;
            document.getElementById('aeroRealBtn').textContent = amount.toFixed(2);

            const steps = [
                `‚ë† Check balances (Base + Arbitrum)`,
                `‚ë° Bridge Arbitrum‚ÜíBase si besoin (Across Protocol, ~60s)`,
                `‚ë¢ Swap ETH‚Üí${aeroCurrentPool ? aeroCurrentPool.symbol.split('-')[0] : 'TOKEN0'} ($${(amount/2).toFixed(2)})`,
                `‚ë¢ Swap ETH‚Üí${aeroCurrentPool ? aeroCurrentPool.symbol.split('-')[1] || 'TOKEN1' : 'TOKEN1'} ($${(amount/2).toFixed(2)})`,
                `‚ë£ Add Liquidity ‚Üí Aerodrome ${aeroCurrentPool ? aeroCurrentPool.symbol : 'Pool'}`,
                `‚úÖ LP tokens dans ton wallet`,
            ];

            document.getElementById('aeroFlowPreview').innerHTML = steps
                .map(s => `<div style="padding:2px 0;">${s}</div>`).join('');
        }

        async function executeAeroInvest(simulate) {
            if (!aeroCurrentPool) return;
            const amount = parseFloat(document.getElementById('aeroAmount').value) || 1;

            const btn = event.target;
            btn.disabled = true;
            btn.textContent = simulate ? '‚è≥ Simulation...' : '‚è≥ Ex√©cution...';

            const resultDiv = document.getElementById('aeroInvestResult');
            resultDiv.style.display = 'none';

            try {
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                if (!isLocal) throw new Error('Serveur Obelisk requis en local (pm2 start obelisk). Les pools sont lisibles partout mais l\'invest n√©cessite le serveur local.');
                const resp = await fetch('http://localhost:3001/api/aerodrome/invest/1click', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        token0:    aeroCurrentPool.tokens[0],
                        token1:    aeroCurrentPool.tokens[1],
                        stable:    aeroCurrentPool.stable,
                        symbol:    aeroCurrentPool.symbol,
                        amountUSD: amount,
                        simulate,
                    })
                });

                const data = await resp.json();

                const ok = data.success;
                const color = ok ? (simulate ? '#9b59b6' : '#00ff88') : '#ff6666';

                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <div style="background:${ok ? 'rgba(0,255,136,0.06)' : 'rgba(255,100,100,0.06)'};border:1px solid ${color};border-radius:10px;padding:14px;margin-bottom:16px;">
                        <div style="font-weight:bold;color:${color};margin-bottom:8px;">
                            ${ok ? (simulate ? 'üéÆ Simulation OK' : '‚úÖ Investi!') : '‚ùå Erreur'}
                        </div>
                        <div style="font-size:13px;color:#aaa;">${data.message || data.error}</div>
                        ${data.basescan ? `<a href="${data.basescan}" target="_blank" style="display:inline-block;margin-top:8px;font-size:12px;color:#00d4ff;">Voir sur Basescan ‚Üí</a>` : ''}
                    </div>
                    ${data.steps ? `
                    <div style="font-size:12px;color:#555;">
                        ${data.steps.map(s => `
                            <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.04);">
                                <span>${s.step}. ${s.name}</span>
                                <span style="color:${s.status==='ok'?'#00ff88':s.status==='simulated'?'#9b59b6':s.status==='skipped'?'#888':'#ff6666'}">${s.status}</span>
                            </div>
                        `).join('')}
                    </div>` : ''}
                `;

                if (ok && !simulate) loadAeroBalances();

            } catch (err) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<div style="color:#ff6666;font-size:13px;">Erreur r√©seau: ${err.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = simulate ? 'üéÆ Simuler' : `üíé Investir $${amount} R√âEL`;
            }
        }

        // Load Aerodrome pools + balances on page load
        loadAerodromePools();
        loadAeroBalances();

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // END AERODROME
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Load combos on page load
        loadCombos();

        // Apply i18n translations
        if (typeof I18n !== 'undefined') {
            I18n.applyTranslations();
        }

        // Close modal on outside click
        document.getElementById('investModal').addEventListener('click', (e) => {
            if (e.target.id === 'investModal') closeModal();
        });
    </script>
</body>
</html>
